# 6章のメモ(TCPソケットとHTTPの実装)

この章ではネットワーク...ソケット通信について  
HTTPの機能を再現しながら学んでいく。

## ネットワークの基本(プロトコルとレイヤー)

ネットワークを通じて、送信者と受信者間で通信を行うにはルールを共有する必要がある  
このルールのことを`プロトコル(通信規約)`という

ネットワークではいくつかのレイヤー(TCP/IP参照モデルとか)に分けられており  
そのレイヤ毎にプロトコルが定義されている。

アプリケーションを作る場合、意識する必要があるのはトランスポート層(TCP/UDP/..)から上だけでよい。  
Go言語ではTCP/UDP、それより上位のHTTPが組み込みの機能で提供されている。

## HTTPとその上のプロトコル

### HTTPのきほん

よく使われるアプリケーション層におけるプロトコルの1つである  
HTTPの基本をまとめていく(HTTP1.0ベース)

HTTPではクライアントのリクエストとサーバのレスポンスが規定されている

クライアントのリクエストは以下のような感じ
```HTTP
メソッド パス HTTP/1.0
ヘッダー1: ヘッダーの値
ヘッダー2: ヘッダーの値
(空行)
リクエストボディー
...
```

1行目でメソッド定義(GETとかPOSTとか)がきます。
その後ヘッダーがありボディがきます。
解析をシンプルに行うため、改行を区切り文字として定義しています。

サーバーのレスポンスは以下のようになっています
```HTTP
HTTP/1.0 200 OK
ヘッダー1: ヘッダーの値
ヘッダー2: ヘッダーの値
(空行)
サーバーレスポンス
```
1行目の`200`はレスポンスの種類で、レスポンスが成功したことを表している。  

HTTPはもともとシンプルな連絡手段だったが、インターネットの普及と共に要求される機能も増えてきた。

### RPC

`Remote Procedure Calling`

サーバに用意されている機能を、ローカルにあるかのように呼び出す仕組み

規格としては`JSON-RPC`,`XML-RPC`などがある。  
JSON-RPCはGoでも標準ライブラリとして提供されている

RPCではHTTPのボディ部分にプロトコルに従ったメッセージを入れてやり取りする
```HTTP
HTTP/1.0 200 OK
ヘッダー1: ヘッダーの値
ヘッダー2: ヘッダーの値
(空行)
<?xml version="1.0">...
<hoge>
  ...
</hoge>
```

### REST

`Representational State Transfer`

ウェブサービスをすベて階層化されたリソースとして表現し、やり取りを行うもの

RESTの思想に従ったシステムをRESTfulと呼ぶ  
最近ではRESTfulの究極形態として`HATEOAS`というのが注目を浴びている  
これはHTTPレスポンスに`リンク`情報を入れて、そこからクライアントプラグラムが自律的にデータ探索をして情報を見つける仕組み(リンクにnextとかprevの情報をもたせてる)(githubのissueがいい例)

### GraphQL

最近注目されているFacebookが提唱している、RPCベースのプロトコル  
SNSなどではリソースが綺麗な階層構造で表現できず、複数の属性から構成されることがある.

複数の属性で構成される要素をピンポイントで取得するための仕組みがGraphQL

## ソケット

アプリケーションを作る際は基本的にアプリケーション層のプロトコルのみを意識すればいい  
では、例えばHTTPはどのような下位レイヤーの仕組みを使っているか

ほとんどのOSではアプリケーション層からトランスポート層のプロトコルを利用するとき`ソケット`という仕組みを利用している。
(ちなみにTLS(SSL)はソケットとHTTPの間に入って暗号化を行う)

一般に他アプリケーションとの通信のことを`プロセス間通信`と呼ぶ  
ソケットもプロセス間通信の1種

ソケットが他とは違うのは、IPアドレスとポートさえ分かれば、ローカルだけでなく外部サーバともやり取りできること。

ソケットにはいくつか種類があるが、このほんで説明するのは

#### TCP

もっともよく使われる安全性の高いソケット
スリーハンドシェイクを行ったのちに通信

#### UDP

通信開始が早い。相手に一方的に送りつける

### Unixドメインソケット

ローカル通信限定だが、最速

アプリケーション間のインターネット通信もこれらのソケットを通じて行われる.