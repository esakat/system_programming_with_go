# 2章のメモ

## ファイルディスクリプタ

前章で`syscall.Write()`が呼び出されているのを確認した
OSではこれが`ファイルディスクリプタ`と呼ばれている

ファイルディスクリプタは一種の識別子
この識別子を指定してシステムコールを呼ぶと、識別子と対応するモノ(ファイルに限らず色々)にアクセスできる

ファイルディスクリプタはOSがカーネルレイヤーで用意している抽象化の仕組み
ファイルじゃないものも擬似ファイル的に扱ってファイルディスクリプタを与えている

この章ではファイルディスクリプタの仕組みを言語レベルで抽象化している `io.Writer`について見て行く

io.WriterはGo言語のインターフェースで実装されている

## インターフェース

インターフェースは構造体などが満たすべき仕様
持つべきメソッドを表現するための言語機能
一般的なオブジェクト指向言語(Javaとか)のインタフェースと同じと考えて良い

Goにはクラスという概念がないが、代わりに構造体がメソッドを持てる
以下のようにfuncキーワードとメソッドのシグネチャ定義の間にレシーバー(`(h Hoge)`)を置くと、構造体にメソッドを定義できる

```Go
// Greatという構造体にSayというメソッドを定義している
func (g Great) Say() {
  fmt.Println(g.name)
}
```

あるインターフェース(Aとする)で宣言されているメソッドがデータ型に対して定義されている場合
`そのデータ型はAを満たす`と言える。これが一般的な静的型付け言語と異なるところで
インターフェースを満たす構造体を定義する際に特に`implements`などのキーワードは不要
構造体のインスタンスのポインタをインターフェース型の変数に代入することで、Go言語のコンパイラが
互換性をチェックする

```Go
// Talker型のインタフェース変数に構造体のポインタを代入している
var talker Talker
talker = &Greeter{"wozozo"}
```

メソッドが副作用を持つ場合(その時々によって引数に関わらず返り値が異なるような)、レシーバーもポインタ型で定義する
C言語と異なり、Goにはガベージコレクタがあるため、宣言時以外は特にポインタ意識しなくて良い
```Go
func (h *Hoge) Say() {
  ...
}
```

## io.Writerを再確認

File型に定義されているメソッドということが分かる

```Go
func (f *File) Write(b []byte) (n int, err error) {
  if f == nil {
    return 0, ErrIntavalid
  }
  n, e := f.write(b)
  :
}
```

### もう少し踏み込んで

File型の構造体へのポインタに対するメソッド(osパッケージが定義するFile型では、ファイルを表現するのに必要なデータが含まれている)

`Write(b []byte) (n int, err error)` というのは`[]byte`型を引数で受け取り、int型とerr型の2つの値を返す

このメソッドは`f`が示すファイルに`b`のバイト列を書き込んで、書き込んだバイト数`n`と結果`err`(errorが起きなかったら`nil`が入る)を返す

---

書き込んだバイト数`n`と結果`err` というのはファイル書き込みだけでなく、もっと汎用的に扱えそう
これをインタフェースとして定義してるのが`io.Writer`

```Go
type Writer interface {
  Write(p []byte) (n int, err error)
}
```

上記の`Write()`はこのインタフェースを`*File`構造体に定義した形である

## byteと文字列について

Go言語においてはbyteと文字列のstringが相互変換可能

```Go
// byteArray = []byte{0x41, 0x53, 0x43, 0x49, 0x49}
byteArray := []byte("ASCII")

// str = "ASCII"
srt := string([]byte{0x41, 0x53, 0x43, 0x49, 0x49})
```

## io.Writerを使う構造体

io.WriterインターフェースはGoのいろんな構造体で実装されている(満たされている)

インタフェースはあくまで`何ができるか`を宣言しているだけ

(例) 書き込む処理でも、ファイルであったり、バッファからであったり、インターネット経由であったりあるが、全て`n`バイトを書き込んで、同じ結果を返すと定義できるよね(もちろん中身の処理は違うけどね)

このフォルダ内においたいろんなサンプルは皆io.Writerインタフェースを満たしている
(処理は違うけど、書いてるプラグラムは似てるよね)

### インターネットアクセスの送信
